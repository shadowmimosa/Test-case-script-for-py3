*** Settings ***
Library           Collections
Library           RequestsLibrary
Library           pymysql
Library           DatabaseLibrary

*** Variable ***
${DB_IP}
*** Keywords ***
db_update
    [Arguments]    ${sql}    ${user}=fanxing    ${pass}=kugou2014    ${db}=d_fanxing   
    [Documentation]    执行DML语句。使用pyodbc进行连接，可以支持正常显示中文。（使用该关键字需要安装pyodbc及mysql-connector）
    ...
    ...    说明：
    ...    _*${DB_IP}需配置于对应项目的config.py下，如soa，配置于/soa/soa_config.py*_
    ...    由于数据库最初连接时指定了database为d_fanxing，操作别的database时需要指定库名。
    ...
    ...    eg：delete from d_fanxing_noncore.t_room_list where ...
    Connect To Database Using Custom Params    pyodbc    "Driver={MySQL ODBC 5.3 Unicode Driver};Server=${DB_IP};Port=3306;Database=${db};User=${user};password=${pass}"
    execute sql string    ${sql}

db_query
    [Arguments]    ${sql}    ${user}=fanxing    ${pass}=kugou2014    ${db}=d_fanxing
    [Documentation]    执行DQL语句。使用pyodbc进行连接，可以支持正常显示中文。（使用该关键字需要安装pyodbc及mysql-connector）
    ...
    ...    说明：
    ...    _*${DB_IP}需配置于对应项目的config.py下，如soa，配置于/soa/soa_config.py*_
    ...    由于数据库最初连接时指定了database为d_fanxing，操作别的database时需要指定库名。
    ...
    ...    eg：select roomid from d_fanxing_noncore.t_room_list where ...
    ...
    ...
    ...    For example, given we have a table `person` with the following data:
    ...
    ...    | id | first_name \ | last_name |
    ...    | \ 1 | Franz Allan | See \ \ \ \ \ \ |
    ...
    ...
    ...
    ...    When you do the following:
    ...
    ...    | @{queryResults} | _*db\_query*_ | select * from person |
    ...    | Log Many | @{queryResults} |
    ...
    ...
    ...
    ...    You will get the following:
    ...
    ...    [1, 'Franz Allan', 'See']
    ...
    ...
    ...
    ...    Also, you can do something like this:
    ...
    ...    | ${queryResults} | _*db\_query*_ | select first_name, last_name from person |
    ...    | Log | ${queryResults[0][1]}, ${queryResults[0][0]} |
    ...
    ...
    ...    And get the following
    ...
    ...    See, Franz Allan
    Connect To Database Using Custom Params    pyodbc    "Driver={MySQL ODBC 5.3 Unicode Driver};Server=${DB_IP};Port=3306;Database=${db};User=${user};password=${pass}"
    @{result}    query    ${sql}
    [Return]    @{result}

db_pymysql_update
    [Arguments]    ${sql}    ${user}=fanxing    ${pass}=kugou2014    ${db}=d_fanxing
    [Documentation]    执行DML语句。使用pymysql进行连接
    ...
    ...    说明：
    ...    _*${DB_IP}需配置于对应项目的config.py下，如soa，配置于/soa/soa_config.py*_
    ...    由于数据库最初连接时指定了database为d_fanxing，操作别的database时需要指定库名。
    ...
    ...    eg：delete from d_fanxing_noncore.t_room_list where ...
    Connect To Database Using Custom Params    pymysql    host='${db_ip}', port=3306, user='${user}', passwd='${pass}', db='${db}', charset='utf8'
    execute sql string    ${sql}
    Disconnect From Database

db_pymysql_query
    [Arguments]    ${sql}    ${user}=fanxing    ${pass}=kugou2014    ${db}=d_fanxing
    [Documentation]    执行DQL语句。使用pymysql进行连接，可以支持正常显示中文
    ...
    ...    说明：
    ...    _*${DB_IP}需配置于对应项目的config.py下，如soa，配置于/soa/soa_config.py*_
    ...    由于数据库最初连接时指定了database为d_fanxing，操作别的database时需要指定库名。
    ...
    ...    eg：select roomid from d_fanxing_noncore.t_room_list where ...
    ...
    ...
    ...    For example, given we have a table `person` with the following data:
    ...
    ...    | id | first_name \ | last_name |
    ...    | \ 1 | Franz Allan | See \ \ \ \ \ \ |
    ...
    ...
    ...
    ...    When you do the following:
    ...
    ...    | @{queryResults} | _*db\_query*_ | select * from person |
    ...    | Log Many | @{queryResults} |
    ...
    ...
    ...
    ...    You will get the following:
    ...
    ...    [1, 'Franz Allan', 'See']
    ...
    ...
    ...
    ...    Also, you can do something like this:
    ...
    ...    | ${queryResults} | _*db\_query*_ | select first_name, last_name from person |
    ...    | Log | ${queryResults[0][1]}, ${queryResults[0][0]} |
    ...
    ...
    ...    And get the following
    ...
    ...    See, Franz Allan
    Connect To Database Using Custom Params    pymysql    host='${db_ip}', port=3306, user='${user}', passwd='${pass}', db='${db}', charset='utf8'
    @{result}    query    ${sql}
    Disconnect From Database
    [Return]    @{result}
